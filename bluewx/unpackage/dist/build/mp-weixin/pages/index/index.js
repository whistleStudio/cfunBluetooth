"use strict";var e=require("../../common/vendor.js"),t=require("../../utils/bt.js");const n={__name:"index",setup(n){let o=e.reactive({isBtInit:!1,devList:[],actId:-1,mode:-1});function i(e){e.detail.value?async function(){try{await t.bt.init()&&(o.isBtInit=!0),await t.bt.search()}catch(e){console.log(e)}}():c()}function c(){o.isBtInit=!1,o.actId=-1,o.mode=-1,o.devList.length=0,t.bt.closeBtAdapter()}return e.onMounted((()=>{t.bt.onFound(o.devList),t.bt.onBtAdapterSta((()=>{c()}))})),e.onPullDownRefresh((()=>{o.isBtInit?(t.bt.search(),e.index.showLoading({title:"正在搜索新设备"}),setTimeout((function(){t.bt.stopSearch(),e.index.stopPullDownRefresh(),e.index.hideLoading()}),3e3)):(e.index.stopPullDownRefresh(),e.index.showToast({title:"蓝牙未初始化",icon:"error"}))})),(n,c)=>e.e({a:e.o(i),b:e.unref(o).isBtInit},e.unref(o).isBtInit?{c:e.f(e.unref(o).devList,((n,i,c)=>e.e({a:e.t(n.name),b:e.unref(o).actId==i},e.unref(o).actId==i?{c:0==e.unref(o).mode?1:"",d:1==e.unref(o).mode?1:""}:{},{e:i,f:e.o((e=>function(e,n){o.actId!=e&&(t.bt.disconnectDev(),o.actId=e,console.log("connect",n),(async()=>{o.mode=0,await t.bt.connectDev(n)?o.mode=1:(o.actId=-1,o.mode=-1)})())}(i,n.deviceId)),i)})))}:{})}};wx.createPage(n);
